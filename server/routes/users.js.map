{"version":3,"sources":["routes/users.ts"],"names":[],"mappings":"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","file":"routes/users.js","sourcesContent":["/* \n    File Name: users.ts \n    Authors: Cindy Diaz, Hae Yeon Kang\n    Website Name: Manage Support Website\n    File Description: Routing for user\n*/\nimport express = require('express');\nimport passport = require('passport');\nvar router = express.Router();\n\n// db references\nimport mongoose = require('mongoose');\nimport userModel = require('../models/user');\n\nimport User = userModel.User;\n\n//utility function to check if user is authenticated\nfunction requireAuth(req: express.Request, res: express.Response, next: any){\n    //check if user is log in\n    if(!req.isAuthenticated()){\n        return res.redirect('/login');\n    }\n    next();\n}\n\n\n// GET - show main users page - list all the users\nrouter.get('/', requireAuth,(req: express.Request, res: express.Response, next: any) => {  \n    // use the Users model to query the Users collection\n    User.find((error, users) => {\n        if (error) {\n            console.log(error);\n            res.end(error);\n        }\n        else {\n            // no error, we found a list of users\n            res.render('users/index', {\n                title: 'Users',\n                users: users,\n                displayName: req.user ? req.user.displayName : '',\n                type: req.user? req.user.type : ''\n            });\n        }\n    });\n});\n\n\n// GET my account page - show the current user in the form\nrouter.get('/myaccount', requireAuth, (req: express.Request, res: express.Response, next: any) => {\n\n    var id = req.user._id;\n\n    User.findById(id, (error, User) => {\n        if (error) {\n            console.log(error);\n            res.end(error);\n        }\n        else {\n            //show the edit view\n            res.render('users/edit', {\n                title: 'My Account',\n                user: User,\n                displayName: req.user ? req.user.displayName : '',\n                type: req.user? req.user.type : ''\n            });\n        }\n    });\n});\n\n\n// POST edit page - update the selected user\nrouter.post('/myaccount', requireAuth,(req: express.Request, res: express.Response, next: any) => {\n\n    // grab the id from the url parameter\n    var id = req.user._id;\n\n    // create and populate a user object\n    var user = new User({\n        _id: id,\n        username: req.body.username,\n        password: req.body.password,\n        email: req.body.email,\n        displayName: req.body.displayName,\n        type: req.body.type\n    });\n\n    // run the update using mongoose and our model\n    User.update({ _id: id }, user, (error) => {\n        if (error) {\n            console.log(error);\n            res.end(error);\n        }\n        else {\n            //if success update\n            res.redirect('/tickets');\n        }\n    });\n});\n\n\n// GET add page - show the blank form\nrouter.get('/add', requireAuth,(req: express.Request, res: express.Response, next: any)=> {\n    res.render('users/add', {\n        title: 'Add a New User',\n        displayName: req.user ? req.user.displayName : '',\n        type: req.user? req.user.type : ''\n    });\n});\n\n// POST add page - save the new user\nrouter.post('/add',requireAuth, (req: express.Request, res: express.Response, next: any) => {\n    User.create({\n        username: req.body.username,\n        password: req.body.password,\n        email: req.body.email,\n        displayName: req.body.displayName,\n        type : req.body.type\n    }, function(error, User) {\n        // did we get back an error or valid Users object?\n        if (error) {\n            console.log(error);\n            res.end(error);\n        }\n        else {\n            res.redirect('/users');\n        }\n    })\n});\n\n\n// GET edit page - show the current user in the form\nrouter.get('/:id', requireAuth, (req: express.Request, res: express.Response, next: any) => {\n\n    var id = req.params.id;\n\n    User.findById(id, (error, User) => {\n        if (error) {\n            console.log(error);\n            res.end(error);\n        }\n        else {\n            //show the edit view\n            res.render('users/edit', {\n                title: 'User Details',\n                user: User,\n                displayName: req.user ? req.user.displayName : '',\n                type: req.user? req.user.type : ''\n            });\n        }\n    });\n});\n\n\n// POST edit page - update the selected user\nrouter.post('/:id', requireAuth,(req: express.Request, res: express.Response, next: any) => {\n\n    // grab the id from the url parameter\n    var id = req.params.id;\n\n    // create and populate a user object\n    var user = new User({\n        _id: id,\n        username: req.body.username,\n        password: req.body.password,\n        email: req.body.email,\n        displayName: req.body.displayName,\n        type : req.body.type\n    });\n\n    // run the update using mongoose and our model\n    User.update({ _id: id }, user, (error) => {\n        if (error) {\n            console.log(error);\n            res.end(error);\n        }\n        else {\n            //if success update\n            res.redirect('/users');\n        }\n    });\n});\n\n\n// GET delete user\nrouter.get('/delete/:id', requireAuth,(req: express.Request, res: express.Response, next: any) => {\n\n    // get the id from the url\n    var id = req.params.id;\n\n    // use the model and delete this record\n    User.remove({ _id: id }, (error) => {\n        if (error) {\n            console.log(error);\n            res.end(error);\n        }\n        else {\n            res.redirect('/users');\n        }\n    });\n});\n\n\n\n// make this public\nmodule.exports = router;"],"sourceRoot":"/source/"}